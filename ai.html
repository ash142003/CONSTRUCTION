<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Material Estimator | ASWIN142003</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css" rel="stylesheet">
  
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  
  <style>
    /* Custom properties from main site */
    :root {
      --primary: #e11d48; /* Red */
      --secondary: #1e3a8a; /* Blue */
    }
    .chat-container {
      height: 500px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #d1d5db #f3f4f6;
    }
    .user-msg {
      background-color: var(--secondary);
      color: white;
      border-radius: 1rem 1rem 0 1rem;
    }
    .bot-msg {
      background-color: #f3f4f6;
      border-radius: 1rem 1rem 1rem 0;
    }
    .typing-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #9ca3af;
      animation: typing 1.4s infinite ease-in-out;
    }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1.0); }
    }
  </style>
</head>
<body class="bg-gray-200 min-h-screen flex items-center justify-center p-4 font-sans">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md flex flex-col">
    <!-- Header -->
    <div class="bg-gray-800 text-white p-4 rounded-t-2xl flex justify-between items-center">
      <div>
        <h1 class="text-xl font-bold">AI Material Estimator</h1>
        <p class="text-xs text-gray-300">By ASWIN142003</p>
      </div>
      <a href="index.html" title="Back to Main Site" class="text-gray-300 hover:text-white transition">
        <i class="ph ph-house text-2xl"></i>
      </a>
    </div>
    
    <!-- Chat Area -->
    <div id="chat" class="chat-container p-4 space-y-4 flex-1"></div>
    
    <!-- Input Area -->
    <div class="p-4 border-t border-gray-200">
      <div id="options" class="mb-2 hidden grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
      <div id="input-area" class="flex space-x-3 items-center">
        <input id="user-input" type="text" placeholder="Type your answer..." 
               class="flex-1 border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
        <button id="send-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
          <i class="ph ph-paper-plane-tilt text-xl"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // --- Configuration & Data ---
    const materialCalculator = {
      residential: { cement: 0.4, concrete: 0.1, steel: 4, bricks: 8, wood: 0.05, sand: 0.05, glass: 0.1, tiles: 1.1 },
      commercial: { cement: 0.5, concrete: 0.15, steel: 6, bricks: 6, wood: 0.03, sand: 0.06, glass: 0.2, tiles: 1.1 },
      industrial: { cement: 0.6, concrete: 0.2, steel: 8, bricks: 4, wood: 0.02, sand: 0.07, glass: 0.15, tiles: 1.05 }
    };

    const chat = document.getElementById('chat');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const optionsDiv = document.getElementById('options');
    const inputArea = document.getElementById('input-area');

    let state = {
      currentStep: 0,
      constructionType: '',
      squareFeet: 0,
      budget: 0,
    };

    const steps = [
      {
        question: "Hello! I'm here to help you estimate the materials for your project. Let's start with the total area.",
        handler: () => {}
      },
      {
        question: "What is the square footage (sqft) of your construction project?",
        key: 'squareFeet',
        validation: (val) => !isNaN(val) && val > 0,
        errorMessage: "Please enter a valid, positive number for the area."
      },
      {
        question: "Great. Now, what type of construction is this?",
        key: 'constructionType',
        options: ["Residential", "Commercial", "Industrial"],
      },
      {
        question: "Got it. Finally, what is your approximate budget (in ‚Çπ)?",
        key: 'budget',
        validation: (val) => !isNaN(val) && val >= 0,
        errorMessage: "Please enter a valid budget amount."
      },
      {
        question: "Perfect! Calculating the material estimates for you now...",
        isAction: true,
        action: () => setTimeout(showResults, 1500)
      }
    ];

    // --- Core Functions ---
    function startConversation() {
      state = { currentStep: 0, constructionType: '', squareFeet: 0, budget: 0 };
      chat.innerHTML = '';
      hideOptions();
      addBotMessage(steps[0].question, false);
      setTimeout(nextStep, 1000);
    }

    function nextStep() {
      state.currentStep++;
      if (state.currentStep >= steps.length) return;

      const step = steps[state.currentStep];
      addBotMessage(step.question);

      if (step.isAction) {
        step.action();
      } else if (step.options) {
        showOptions(step.options);
      } else {
        hideOptions();
        userInput.focus();
      }
    }

    function handleResponse(answer) {
      if (!answer.trim()) return;
      addUserMessage(answer);
      userInput.value = '';

      const step = steps[state.currentStep];
      const parsedAnswer = step.options ? answer.toLowerCase() : parseInt(answer.replace(/,/g, ''));
      
      if (step.validation && !step.validation(parsedAnswer)) {
        addBotMessage(step.errorMessage);
        return;
      }
      
      state[step.key] = parsedAnswer;
      hideOptions();
      setTimeout(nextStep, 800);
    }
    
    function showResults() {
      const materials = materialCalculator[state.constructionType];
      if (!materials) {
          addBotMessage("Sorry, something went wrong with the calculation. Please try again.");
          return;
      }

      const results = `
        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
          <h3 class="font-bold text-lg mb-3 text-gray-800">üìù Material Estimates</h3>
          <p class="text-sm text-gray-600 mb-3 pb-3 border-b">For a <strong>${state.squareFeet.toLocaleString()} sqft</strong> ${state.constructionType} project:</p>
          <ul class="space-y-2 text-sm text-gray-700">
            <li><span class="font-semibold w-24 inline-block">Cement:</span> ${Math.round(materials.cement * state.squareFeet).toLocaleString()} bags</li>
            <li><span class="font-semibold w-24 inline-block">Concrete:</span> ${Math.round(materials.concrete * state.squareFeet).toLocaleString()} cu. yards</li>
            <li><span class="font-semibold w-24 inline-block">Steel:</span> ${Math.round(materials.steel * state.squareFeet).toLocaleString()} kg</li>
            <li><span class="font-semibold w-24 inline-block">Bricks:</span> ${Math.round(materials.bricks * state.squareFeet).toLocaleString()} units</li>
            <li><span class="font-semibold w-24 inline-block">Sand:</span> ${Math.round(materials.sand * state.squareFeet).toLocaleString()} cu. meters</li>
            <li><span class="font-semibold w-24 inline-block">Tiles:</span> ${Math.round(materials.tiles * state.squareFeet).toLocaleString()} sqft</li>
          </ul>
          <div class="mt-4 p-3 bg-blue-50 rounded-lg text-blue-800">
            <p class="font-bold">üí∞ Budget Note:</p>
            <p class="text-sm">Your budget of ‚Çπ${state.budget.toLocaleString()} averages to <strong>‚Çπ${Math.round(state.budget / state.squareFeet).toLocaleString()} per sqft</strong>.</p>
          </div>
        </div>
      `;
      addBotMessage(results, false);
      addBotMessage("Would you like to start a new calculation?", false);
      showOptions(["New Calculation"]);
    }

    // --- UI & Helper Functions ---
    function addUserMessage(text) {
      const msgDiv = document.createElement('div');
      msgDiv.className = 'user-msg py-2 px-4 self-end max-w-xs sm:max-w-sm ml-auto break-words';
      msgDiv.textContent = text;
      chat.appendChild(msgDiv);
      scrollToBottom();
    }

    function addBotMessage(content, showTyping = true) {
      if (showTyping) {
        const typingDiv = document.createElement('div');
        typingDiv.className = 'bot-msg py-3 px-4 self-start flex items-center space-x-1';
        typingDiv.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
        chat.appendChild(typingDiv);
        scrollToBottom();
        
        setTimeout(() => {
          chat.removeChild(typingDiv);
          createBotMessage(content);
        }, 1200);
      } else {
        createBotMessage(content);
      }
    }
    
    function createBotMessage(content) {
        const msgDiv = document.createElement('div');
        msgDiv.className = 'bot-msg py-2 px-4 self-start max-w-xs sm:max-w-sm mr-auto break-words';
        msgDiv.innerHTML = content;
        chat.appendChild(msgDiv);
        scrollToBottom();
    }

    function showOptions(options) {
      inputArea.classList.add('hidden');
      optionsDiv.innerHTML = '';
      optionsDiv.classList.remove('hidden');
      
      options.forEach(option => {
        const btn = document.createElement('button');
        btn.textContent = option;
        btn.className = 'bg-gray-200 text-gray-800 p-2 text-sm rounded-lg hover:bg-gray-300 transition focus:outline-none focus:ring-2 focus:ring-blue-400';
        btn.onclick = () => {
          if (option === "New Calculation") {
            startConversation();
          } else {
            handleResponse(option);
          }
        };
        optionsDiv.appendChild(btn);
      });
    }

    function hideOptions() {
      optionsDiv.classList.add('hidden');
      inputArea.classList.remove('hidden');
    }

    function scrollToBottom() {
      chat.scrollTop = chat.scrollHeight;
    }

    // --- Event Listeners ---
    sendBtn.addEventListener('click', () => handleResponse(userInput.value));
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') handleResponse(userInput.value);
    });

    // --- Initialisation ---
    startConversation();
  </script>
</body>
</html>